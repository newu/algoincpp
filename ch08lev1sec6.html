<html><head><title>8.6. Performance Characteristics of Mergesort</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch08lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch08lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="17051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>C++ Programming Robert Sedgewick - Princeton University Addison Wesley Professional Algorithms in C++, Parts 1&ndash;4: Fundamentals, Data Structure, Sorting, Searching, Third Edition<a name="ch08lev1sec6"></a>
<h3 id="title-IDAKMNJK" class="docSection1Title">8.6. Performance Characteristics of Mergesort</h3>
<p class="docText"><a class="docLink" href="#ch08table01">Table 8.1</a> shows the relative effectiveness of the various improvements that we have examined. As is often the case, these studies indicate that we can cut the running time by half or more when we focus on improving the inner loop of the algorithm.</p>
<a name="ch08table01"></a><p><table cellspacing="0" frame="hsides" rules="none" cellpadding="5"><caption><h5 class="docTableTitle">Table 8.1. Empirical study of mergesort algorithms</h5></caption><colgroup align="left" span="7"><col width="75"></col><col width="75"></col><col width="75"></col><col width="75"></col><col width="75"></col><col width="75"></col><col width="75"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top" colspan="7"><p class="docText">These relative timings for various sorts on random files of floating point numbers, for various values of <span class="docEmphasis">N</span>, indicate that standard quicksort is about twice as fast as standard mergesort; that adding a cutoff for small files lowers the running times of both bottom-up and top-down mergesort by about 15 percent; that top-down mergesort is about 10 percent faster than bottom-up mergesort for these file sizes; and that even eliminating the cost of the file copy leaves mergesort 50 to 60 percent slower than plain quicksort for randomly ordered files (see <a class="docLink" href="ch07lev1sec5.html#ch07table01">Table 7.1</a>).</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"></p></td><td class="bottomBorder" align="center" valign="top" colspan="3"><p class="docText">top-down</p></td><td class="bottomBorder" align="center" valign="top" colspan="2"><p class="docText">bottom-up</p></td></tr><tr><td class="bottomBorder" align="right" valign="top"><p class="docText"><span class="docEmphasis">N</span></p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">Q</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">T</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">T<sup>*</sup></p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">O</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">B</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">B<sup>*</sup></p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">12500</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">2</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">5</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">4</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">4</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">5</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">4</p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">25000</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">5</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">12</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">8</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">8</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">11</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">9</p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">50000</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">11</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">23</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">20</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">17</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">26</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">23</p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">100000</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">24</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">53</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">43</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">37</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">59</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">53</p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">200000</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">52</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">111</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">92</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">78</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">127</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">110</p></td></tr><tr><td class="docTableCell" align="right" valign="top"><p class="docText">400000</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">109</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">237</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">198</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">168</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">267</p></td><td class="docTableCell" align="right" valign="top"><p class="docText">232</p></td></tr><tr><td class="bottomBorder" align="right" valign="top"><p class="docText">800000</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">241</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">524</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">426</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">358</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">568</p></td><td class="bottomBorder" align="right" valign="top"><p class="docText">496</p></td></tr><tr><td class="docTableCell" align="left" valign="top" colspan="7"><p class="docText"><span class="docEmphasis">Key</span>:</p>
<blockquote><p></p><p class="docList">Q Quicksort, standard (<a class="docLink" href="ch07lev1sec1.html#ch07ex01">Program 7.1</a>)</p></blockquote></td></tr></table></p><p></p><p class="docList">T Top-down mergesort, standard (<a class="docLink" href="ch08lev1sec1.html#ch08ex01">Program 8.1</a>)</p><p></p><p class="docList">T* Top-down mergesort with cutoff for small files</p><p></p><p class="docList">O Top-down mergesort with cutoff and no array copy</p><p></p><p class="docList">B Bottom-up mergesort, standard (<a class="docLink" href="ch08lev1sec5.html#ch08ex09">Program 8.5</a>)</p><p></p><p class="docList">B* Bottom-up mergesort with cutoff for small files</p></td></tr></table><br />
<p class="docText">In addition to netting the improvements discussed in <a class="docLink" href="ch08lev1sec2.html#ch08lev1sec2">Section 8.2</a>, we might achieve further gains by ensuring that the smallest elements in the two arrays are kept in simple variables or machine registers, to avoid unnecessary array accesses. Thus, the inner loop of mergesort can basically be reduced to a comparison (with conditional branch), two pointer increments (<tt>k</tt> and either <tt>i</tt> or <tt>j</tt>), and a test with conditional branch for loop completion. The total number of instructions in the <a name="iddle1421"></a>inner loop is slightly higher than that for quicksort, but the instructions are executed only <span class="docEmphasis">N</span> lg <span class="docEmphasis">N</span> times, where quicksort's are executed 39 percent more often (or 29 percent with the median-of-three modification). Careful implementation and detailed analysis are required for more precise comparison of the algorithms in particular environments; nonetheless, we do know that mergesort has an inner loop that is slightly longer than that of quicksort.</p>
<p class="docText">As usual, we must add the caveat that pursuit of improvements of this nature, although irresistible to many programmers, can sometimes <a name="iddle1887"></a>lead to marginal gains and should be taken on only after more important considerations have been resolved. In this case, mergesort has the clear advantages over quicksort that it is stable and is guaranteed to run fast (no matter what the input), and the clear disadvantage that it uses extra space proportional to the size of the array. If these factors point to the use of mergesort (and speed is important), then the improvements that we have suggested may be worth considering, along with careful study of the code produced by compilers, the special properties of the machine architecture, and so forth.</p>
<p class="docText"><a name="iddle1810"></a><a name="iddle1892"></a>On the other hand, we must also add the usual caveat that programmers should always have one eye on performance, to avoid costs that are completely unnecessary. All programmers (and authors!) have suffered the embarrassment of having a simple unnoticed characteristic of an implementation dominate all that implementation's other sophisticated mechanisms. It is not unusual for a factor-of-2 improvement in running time to be found when implementations are examined carefully in this way. Frequent testing is the most effective defense against last-minute surprises of this type.</p>
<p class="docText">We discussed these points at length in <a class="docLink" href="ch05.html#ch05">Chapter 5</a>, but the allure of premature optimization is so strong that it is worthwhile to reinforce them each time that we study techniques for performance improvement at this level of detail. For mergesort, we are comfortable with optimizing because <a class="docLink" href="ch08lev1sec3.html#ch08ex04">Properties 8.1</a> through <a class="docLink" href="ch08lev1sec3.html#ch08ex07">8.4</a> essentially characterize the performance, and hold for all the implementations that we have examined: Their running time is proportional to <span class="docEmphasis">N</span> <span class="docEmphRoman">log</span> <span class="docEmphasis">N</span>, and is insensitive to the input (see <a class="docLink" href="#ch08fig08">Figure 8.8</a>); they use extra space; and they can be implemented in a stable manner. Maintaining these while improving the running time is generally not difficult.</p>
<a name="ch08fig08"></a><p><center>
<h5 class="docFigureTitle">Figure 8.8. Sorting of various types of files with bottom-up mergesort</h5>
<h5></h5><h5></h5></center></p><p class="docText">The running time for mergesort is insensitive to the input. These diagrams illustrate that the number of passes taken by bottom-up mergesort for files that are random, Gaussian, nearly ordered, nearly reverse ordered, and randomly ordered with 10 distinct key values <span class="docEmphasis">(left to right)</span> depends only on the file size, no matter what the input values are. This behavior is in sharp contrast to that of quicksort and to that of many other algorithms.</p>
<p class="docText">
<img border="0" alt="" width="300" height="372" src="08fig08.gif" /></p>
<br />
<p class="docQandasetTitle">Exercises</p><p><table border="0" cellspacing="16" cellpadding="0"><tr valign="top"><td align="right" class="docText" width="50"><a name="ch08qa6q1"></a><b></b></td><td><p class="docText"><span class="docEmphStrong">8.31</span> Implement bottom-up mergesort with no array copy.</p></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch08qa6q2"></a><b></b></td><td><p class="docText"><span class="docEmphStrong">8.32</span> Develop a three-level hybrid sort that uses quicksort, mergesort, and insertion sort to get a method that is as fast as the most efficient quicksort (even on small files), but can guarantee better than quadratic performance in the worst case.</p></td></tr></table></p>
<a href="17051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></div></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch08lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch08lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table><!--IP User 2--></td></body></head></html>